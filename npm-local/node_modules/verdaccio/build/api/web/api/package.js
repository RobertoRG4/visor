"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _express = require("express");
var _lodash = _interopRequireDefault(require("lodash"));
var _config = require("@verdaccio/config");
var _middleware = require("@verdaccio/middleware");
var _tarball = require("@verdaccio/tarball");
var _utils = require("@verdaccio/utils");
var _constants = require("../../../lib/constants");
var _logger = require("../../../lib/logger");
var _utils2 = require("../../../lib/utils");
var _utils3 = require("./utils");
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
const getOrder = (order = 'asc') => {
  return order === 'asc';
};
function addPackageWebApi(storage, auth, config) {
  /* eslint new-cap:off */
  const pkgRouter = (0, _express.Router)();
  const can = (0, _middleware.allow)(auth, {
    beforeAll: (params, message) => {
      _logger.logger.debug(params, message);
    },
    afterAll: (params, message) => _logger.logger.debug(params, message)
  });
  const checkAllow = (name, remoteUser) => new Promise((resolve, reject) => {
    try {
      const isLoginEnabled = _lodash.default.isNil(config?.web?.login) || config?.web?.login === true;
      const anonymousRemoteUser = (0, _config.createAnonymousRemoteUser)();
      const remoteUserAccess = !isLoginEnabled ? anonymousRemoteUser : remoteUser;
      auth.allow_access({
        packageName: name
      }, remoteUserAccess, (err, allowed) => {
        if (err) {
          resolve(false);
        }
        resolve(allowed);
      });
    } catch (err) {
      reject(err);
    }
  });

  // Get list of all visible package
  pkgRouter.get((0, _utils3.wrapPath)(_middleware.WebUrls.packages_all), function (req, res, next) {
    storage.getLocalDatabase(async function (err, packages) {
      if (err) {
        throw err;
      }
      async function processPackages(packages = []) {
        const permissions = [];
        const packgesCopy = packages.slice();
        for (const pkg of packgesCopy) {
          const pkgCopy = {
            ...pkg
          };
          pkgCopy.author = (0, _utils.formatAuthor)(pkg.author);
          try {
            const isAllowed = await checkAllow(pkg.name, req.remote_user);
            if (isAllowed) {
              if (config.web) {
                pkgCopy.author.avatar = (0, _utils.generateGravatarUrl)(pkgCopy.author.email, config.web.gravatar);
              }
              if (!_lodash.default.isNil(pkgCopy.dist) && !_lodash.default.isNull(pkgCopy.dist.tarball)) {
                pkgCopy.dist.tarball = (0, _tarball.getLocalRegistryTarballUri)(pkgCopy.dist.tarball, pkg.name, {
                  protocol: req.protocol,
                  headers: req.headers,
                  host: req.hostname
                }, config.url_prefix);
              }
              permissions.push(pkgCopy);
            }
          } catch (err) {
            _logger.logger.error({
              name: pkg.name,
              error: err
            }, 'permission process for @{name} has failed: @{error}');
            throw err;
          }
        }
        return permissions;
      }
      const order = config.web ? getOrder(config.web?.sort_packages) : true;
      try {
        next((0, _utils2.sortByName)(await processPackages(packages), order));
      } catch (error) {
        next(_utils2.ErrorCode.getInternalError(error.message));
      }
    });
  });

  // Get package readme
  pkgRouter.get([(0, _utils3.wrapPath)(_middleware.WebUrls.readme_package_scoped_version), (0, _utils3.wrapPath)(_middleware.WebUrls.readme_package_version)], can('access'), function (req, res, next) {
    const rawScope = req.params.scope; // May include '@'
    const scope = rawScope ? rawScope.slice(1) : null; // Remove '@' if present
    const packageName = scope ? (0, _utils2.addScope)(scope, req.params.package) : req.params.package;
    storage.getPackage({
      name: packageName,
      uplinksLook: true,
      req,
      callback: function (err, info) {
        if (err) {
          return next(err);
        }
        res.set(_constants.HEADER_TYPE.CONTENT_TYPE, _constants.HEADERS.TEXT_PLAIN);
        next((0, _utils2.parseReadme)(info.name, info.readme));
      }
    });
  });
  pkgRouter.get([(0, _utils3.wrapPath)(_middleware.WebUrls.sidebar_scopped_package), (0, _utils3.wrapPath)(_middleware.WebUrls.sidebar_package)], can('access'), function (req, res, next) {
    const rawScope = req.params.scope; // May include '@'
    const scope = rawScope ? rawScope.slice(1) : null; // Remove '@' if present
    const packageName = scope ? (0, _utils2.addScope)(scope, req.params.package) : req.params.package;
    storage.getPackage({
      name: packageName,
      uplinksLook: true,
      keepUpLinkData: true,
      req,
      callback: function (err, info) {
        if (_lodash.default.isNil(err)) {
          const {
            v
          } = req.query;
          let sideBarInfo = _lodash.default.clone(info);
          sideBarInfo.versions = (0, _tarball.convertDistRemoteToLocalTarballUrls)(info, {
            protocol: req.protocol,
            headers: req.headers,
            host: req.hostname
          }, config.url_prefix).versions;
          if ((0, _utils2.isVersionValid)(info, v)) {
            // @ts-ignore
            sideBarInfo.latest = sideBarInfo.versions[v];
            sideBarInfo.latest.author = (0, _utils.formatAuthor)(sideBarInfo.latest.author);
          } else {
            sideBarInfo.latest = sideBarInfo.versions[info[_constants.DIST_TAGS].latest];
            if (sideBarInfo?.latest) {
              sideBarInfo.latest.author = (0, _utils.formatAuthor)(sideBarInfo.latest.author);
            } else {
              res.status(_constants.HTTP_STATUS.NOT_FOUND);
              res.end();
              return;
            }
          }
          sideBarInfo = (0, _utils2.deleteProperties)(['readme', '_attachments', '_rev', 'name'], sideBarInfo);
          if (config.web) {
            sideBarInfo = (0, _utils.addGravatarSupport)(sideBarInfo, config.web.gravatar);
          } else {
            sideBarInfo = (0, _utils.addGravatarSupport)(sideBarInfo);
          }
          next(sideBarInfo);
        } else {
          res.status(_constants.HTTP_STATUS.NOT_FOUND);
          res.end();
        }
      }
    });
  });
  return pkgRouter;
}
var _default = exports.default = addPackageWebApi;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwcmVzcyIsInJlcXVpcmUiLCJfbG9kYXNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9jb25maWciLCJfbWlkZGxld2FyZSIsIl90YXJiYWxsIiwiX3V0aWxzIiwiX2NvbnN0YW50cyIsIl9sb2dnZXIiLCJfdXRpbHMyIiwiX3V0aWxzMyIsImUiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsImdldE9yZGVyIiwib3JkZXIiLCJhZGRQYWNrYWdlV2ViQXBpIiwic3RvcmFnZSIsImF1dGgiLCJjb25maWciLCJwa2dSb3V0ZXIiLCJSb3V0ZXIiLCJjYW4iLCJhbGxvdyIsImJlZm9yZUFsbCIsInBhcmFtcyIsIm1lc3NhZ2UiLCJsb2dnZXIiLCJkZWJ1ZyIsImFmdGVyQWxsIiwiY2hlY2tBbGxvdyIsIm5hbWUiLCJyZW1vdGVVc2VyIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJpc0xvZ2luRW5hYmxlZCIsIl8iLCJpc05pbCIsIndlYiIsImxvZ2luIiwiYW5vbnltb3VzUmVtb3RlVXNlciIsImNyZWF0ZUFub255bW91c1JlbW90ZVVzZXIiLCJyZW1vdGVVc2VyQWNjZXNzIiwiYWxsb3dfYWNjZXNzIiwicGFja2FnZU5hbWUiLCJlcnIiLCJhbGxvd2VkIiwiZ2V0Iiwid3JhcFBhdGgiLCJXZWJVcmxzIiwicGFja2FnZXNfYWxsIiwicmVxIiwicmVzIiwibmV4dCIsImdldExvY2FsRGF0YWJhc2UiLCJwYWNrYWdlcyIsInByb2Nlc3NQYWNrYWdlcyIsInBlcm1pc3Npb25zIiwicGFja2dlc0NvcHkiLCJzbGljZSIsInBrZyIsInBrZ0NvcHkiLCJhdXRob3IiLCJmb3JtYXRBdXRob3IiLCJpc0FsbG93ZWQiLCJyZW1vdGVfdXNlciIsImF2YXRhciIsImdlbmVyYXRlR3JhdmF0YXJVcmwiLCJlbWFpbCIsImdyYXZhdGFyIiwiZGlzdCIsImlzTnVsbCIsInRhcmJhbGwiLCJnZXRMb2NhbFJlZ2lzdHJ5VGFyYmFsbFVyaSIsInByb3RvY29sIiwiaGVhZGVycyIsImhvc3QiLCJob3N0bmFtZSIsInVybF9wcmVmaXgiLCJwdXNoIiwiZXJyb3IiLCJzb3J0X3BhY2thZ2VzIiwic29ydEJ5TmFtZSIsIkVycm9yQ29kZSIsImdldEludGVybmFsRXJyb3IiLCJyZWFkbWVfcGFja2FnZV9zY29wZWRfdmVyc2lvbiIsInJlYWRtZV9wYWNrYWdlX3ZlcnNpb24iLCJyYXdTY29wZSIsInNjb3BlIiwiYWRkU2NvcGUiLCJwYWNrYWdlIiwiZ2V0UGFja2FnZSIsInVwbGlua3NMb29rIiwiY2FsbGJhY2siLCJpbmZvIiwic2V0IiwiSEVBREVSX1RZUEUiLCJDT05URU5UX1RZUEUiLCJIRUFERVJTIiwiVEVYVF9QTEFJTiIsInBhcnNlUmVhZG1lIiwicmVhZG1lIiwic2lkZWJhcl9zY29wcGVkX3BhY2thZ2UiLCJzaWRlYmFyX3BhY2thZ2UiLCJrZWVwVXBMaW5rRGF0YSIsInYiLCJxdWVyeSIsInNpZGVCYXJJbmZvIiwiY2xvbmUiLCJ2ZXJzaW9ucyIsImNvbnZlcnREaXN0UmVtb3RlVG9Mb2NhbFRhcmJhbGxVcmxzIiwiaXNWZXJzaW9uVmFsaWQiLCJsYXRlc3QiLCJESVNUX1RBR1MiLCJzdGF0dXMiLCJIVFRQX1NUQVRVUyIsIk5PVF9GT1VORCIsImVuZCIsImRlbGV0ZVByb3BlcnRpZXMiLCJhZGRHcmF2YXRhclN1cHBvcnQiLCJfZGVmYXVsdCIsImV4cG9ydHMiXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvYXBpL3dlYi9hcGkvcGFja2FnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmltcG9ydCB7IGNyZWF0ZUFub255bW91c1JlbW90ZVVzZXIgfSBmcm9tICdAdmVyZGFjY2lvL2NvbmZpZyc7XG5pbXBvcnQgeyBXZWJVcmxzLCBhbGxvdyB9IGZyb20gJ0B2ZXJkYWNjaW8vbWlkZGxld2FyZSc7XG5pbXBvcnQge1xuICBjb252ZXJ0RGlzdFJlbW90ZVRvTG9jYWxUYXJiYWxsVXJscyxcbiAgZ2V0TG9jYWxSZWdpc3RyeVRhcmJhbGxVcmksXG59IGZyb20gJ0B2ZXJkYWNjaW8vdGFyYmFsbCc7XG5pbXBvcnQgeyBDb25maWcsIE1hbmlmZXN0LCBSZW1vdGVVc2VyIH0gZnJvbSAnQHZlcmRhY2Npby90eXBlcyc7XG5pbXBvcnQgeyBhZGRHcmF2YXRhclN1cHBvcnQsIGZvcm1hdEF1dGhvciwgZ2VuZXJhdGVHcmF2YXRhclVybCB9IGZyb20gJ0B2ZXJkYWNjaW8vdXRpbHMnO1xuXG5pbXBvcnQgQXV0aCBmcm9tICcuLi8uLi8uLi9saWIvYXV0aCc7XG5pbXBvcnQgeyBESVNUX1RBR1MsIEhFQURFUlMsIEhFQURFUl9UWVBFLCBIVFRQX1NUQVRVUyB9IGZyb20gJy4uLy4uLy4uL2xpYi9jb25zdGFudHMnO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vLi4vLi4vbGliL2xvZ2dlcic7XG5pbXBvcnQgU3RvcmFnZSBmcm9tICcuLi8uLi8uLi9saWIvc3RvcmFnZSc7XG5pbXBvcnQge1xuICBFcnJvckNvZGUsXG4gIGFkZFNjb3BlLFxuICBkZWxldGVQcm9wZXJ0aWVzLFxuICBpc1ZlcnNpb25WYWxpZCxcbiAgcGFyc2VSZWFkbWUsXG4gIHNvcnRCeU5hbWUsXG59IGZyb20gJy4uLy4uLy4uL2xpYi91dGlscyc7XG5pbXBvcnQgeyAkTmV4dEZ1bmN0aW9uVmVyLCAkUmVxdWVzdEV4dGVuZCwgJFJlc3BvbnNlRXh0ZW5kLCAkU2lkZWJhclBhY2thZ2UgfSBmcm9tICcuLi8uLi8uLi90eXBlcyc7XG5pbXBvcnQgeyB3cmFwUGF0aCB9IGZyb20gJy4vdXRpbHMnO1xuXG5jb25zdCBnZXRPcmRlciA9IChvcmRlciA9ICdhc2MnKSA9PiB7XG4gIHJldHVybiBvcmRlciA9PT0gJ2FzYyc7XG59O1xuXG5leHBvcnQgdHlwZSBQYWNrY2FnZUV4dCA9IE1hbmlmZXN0ICYgeyBhdXRob3I6IGFueTsgZGlzdD86IHsgdGFyYmFsbDogc3RyaW5nIH0gfTtcblxuZnVuY3Rpb24gYWRkUGFja2FnZVdlYkFwaShzdG9yYWdlOiBTdG9yYWdlLCBhdXRoOiBBdXRoLCBjb25maWc6IENvbmZpZyk6IFJvdXRlciB7XG4gIC8qIGVzbGludCBuZXctY2FwOm9mZiAqL1xuICBjb25zdCBwa2dSb3V0ZXIgPSBSb3V0ZXIoKTtcbiAgY29uc3QgY2FuID0gYWxsb3coYXV0aCwge1xuICAgIGJlZm9yZUFsbDogKHBhcmFtcywgbWVzc2FnZSkgPT4ge1xuICAgICAgbG9nZ2VyLmRlYnVnKHBhcmFtcywgbWVzc2FnZSk7XG4gICAgfSxcbiAgICBhZnRlckFsbDogKHBhcmFtcywgbWVzc2FnZSkgPT4gbG9nZ2VyLmRlYnVnKHBhcmFtcywgbWVzc2FnZSksXG4gIH0pO1xuXG4gIGNvbnN0IGNoZWNrQWxsb3cgPSAobmFtZSwgcmVtb3RlVXNlcik6IFByb21pc2U8Ym9vbGVhbj4gPT5cbiAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KTogdm9pZCA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBpc0xvZ2luRW5hYmxlZCA9IF8uaXNOaWwoY29uZmlnPy53ZWI/LmxvZ2luKSB8fCBjb25maWc/LndlYj8ubG9naW4gPT09IHRydWU7XG4gICAgICAgIGNvbnN0IGFub255bW91c1JlbW90ZVVzZXI6IFJlbW90ZVVzZXIgPSBjcmVhdGVBbm9ueW1vdXNSZW1vdGVVc2VyKCk7XG4gICAgICAgIGNvbnN0IHJlbW90ZVVzZXJBY2Nlc3MgPSAhaXNMb2dpbkVuYWJsZWQgPyBhbm9ueW1vdXNSZW1vdGVVc2VyIDogcmVtb3RlVXNlcjtcbiAgICAgICAgYXV0aC5hbGxvd19hY2Nlc3MoeyBwYWNrYWdlTmFtZTogbmFtZSB9LCByZW1vdGVVc2VyQWNjZXNzLCAoZXJyLCBhbGxvd2VkKTogdm9pZCA9PiB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgcmVzb2x2ZShmYWxzZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlc29sdmUoYWxsb3dlZCBhcyBib29sZWFuKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgLy8gR2V0IGxpc3Qgb2YgYWxsIHZpc2libGUgcGFja2FnZVxuICBwa2dSb3V0ZXIuZ2V0KFxuICAgIHdyYXBQYXRoKFdlYlVybHMucGFja2FnZXNfYWxsKSxcbiAgICBmdW5jdGlvbiAocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIpOiB2b2lkIHtcbiAgICAgIHN0b3JhZ2UuZ2V0TG9jYWxEYXRhYmFzZShhc3luYyBmdW5jdGlvbiAoZXJyLCBwYWNrYWdlcyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICB9XG5cbiAgICAgICAgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc1BhY2thZ2VzKHBhY2thZ2VzOiBQYWNrY2FnZUV4dFtdID0gW10pOiBQcm9taXNlPGFueT4ge1xuICAgICAgICAgIGNvbnN0IHBlcm1pc3Npb25zOiBQYWNrY2FnZUV4dFtdID0gW107XG4gICAgICAgICAgY29uc3QgcGFja2dlc0NvcHkgPSBwYWNrYWdlcy5zbGljZSgpO1xuICAgICAgICAgIGZvciAoY29uc3QgcGtnIG9mIHBhY2tnZXNDb3B5KSB7XG4gICAgICAgICAgICBjb25zdCBwa2dDb3B5ID0geyAuLi5wa2cgfTtcbiAgICAgICAgICAgIHBrZ0NvcHkuYXV0aG9yID0gZm9ybWF0QXV0aG9yKHBrZy5hdXRob3IpO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgY29uc3QgaXNBbGxvd2VkID0gYXdhaXQgY2hlY2tBbGxvdyhwa2cubmFtZSwgcmVxLnJlbW90ZV91c2VyKTtcbiAgICAgICAgICAgICAgaWYgKGlzQWxsb3dlZCkge1xuICAgICAgICAgICAgICAgIGlmIChjb25maWcud2ViKSB7XG4gICAgICAgICAgICAgICAgICBwa2dDb3B5LmF1dGhvci5hdmF0YXIgPSBnZW5lcmF0ZUdyYXZhdGFyVXJsKFxuICAgICAgICAgICAgICAgICAgICBwa2dDb3B5LmF1dGhvci5lbWFpbCxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLndlYi5ncmF2YXRhclxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFfLmlzTmlsKHBrZ0NvcHkuZGlzdCkgJiYgIV8uaXNOdWxsKHBrZ0NvcHkuZGlzdC50YXJiYWxsKSkge1xuICAgICAgICAgICAgICAgICAgcGtnQ29weS5kaXN0LnRhcmJhbGwgPSBnZXRMb2NhbFJlZ2lzdHJ5VGFyYmFsbFVyaShcbiAgICAgICAgICAgICAgICAgICAgcGtnQ29weS5kaXN0LnRhcmJhbGwsXG4gICAgICAgICAgICAgICAgICAgIHBrZy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICB7IHByb3RvY29sOiByZXEucHJvdG9jb2wsIGhlYWRlcnM6IHJlcS5oZWFkZXJzIGFzIGFueSwgaG9zdDogcmVxLmhvc3RuYW1lIH0sXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy51cmxfcHJlZml4XG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwZXJtaXNzaW9ucy5wdXNoKHBrZ0NvcHkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKFxuICAgICAgICAgICAgICAgIHsgbmFtZTogcGtnLm5hbWUsIGVycm9yOiBlcnIgfSxcbiAgICAgICAgICAgICAgICAncGVybWlzc2lvbiBwcm9jZXNzIGZvciBAe25hbWV9IGhhcyBmYWlsZWQ6IEB7ZXJyb3J9J1xuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHBlcm1pc3Npb25zO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgb3JkZXI6IGJvb2xlYW4gPSBjb25maWcud2ViID8gZ2V0T3JkZXIoY29uZmlnLndlYj8uc29ydF9wYWNrYWdlcykgOiB0cnVlO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgbmV4dChzb3J0QnlOYW1lKGF3YWl0IHByb2Nlc3NQYWNrYWdlcyhwYWNrYWdlcyksIG9yZGVyKSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgICBuZXh0KEVycm9yQ29kZS5nZXRJbnRlcm5hbEVycm9yKGVycm9yLm1lc3NhZ2UpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICApO1xuXG4gIC8vIEdldCBwYWNrYWdlIHJlYWRtZVxuICBwa2dSb3V0ZXIuZ2V0KFxuICAgIFt3cmFwUGF0aChXZWJVcmxzLnJlYWRtZV9wYWNrYWdlX3Njb3BlZF92ZXJzaW9uKSwgd3JhcFBhdGgoV2ViVXJscy5yZWFkbWVfcGFja2FnZV92ZXJzaW9uKV0sXG4gICAgY2FuKCdhY2Nlc3MnKSxcbiAgICBmdW5jdGlvbiAocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIpOiB2b2lkIHtcbiAgICAgIGNvbnN0IHJhd1Njb3BlID0gcmVxLnBhcmFtcy5zY29wZTsgLy8gTWF5IGluY2x1ZGUgJ0AnXG4gICAgICBjb25zdCBzY29wZSA9IHJhd1Njb3BlID8gcmF3U2NvcGUuc2xpY2UoMSkgOiBudWxsOyAvLyBSZW1vdmUgJ0AnIGlmIHByZXNlbnRcbiAgICAgIGNvbnN0IHBhY2thZ2VOYW1lID0gc2NvcGUgPyBhZGRTY29wZShzY29wZSwgcmVxLnBhcmFtcy5wYWNrYWdlKSA6IHJlcS5wYXJhbXMucGFja2FnZTtcblxuICAgICAgc3RvcmFnZS5nZXRQYWNrYWdlKHtcbiAgICAgICAgbmFtZTogcGFja2FnZU5hbWUsXG4gICAgICAgIHVwbGlua3NMb29rOiB0cnVlLFxuICAgICAgICByZXEsXG4gICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoZXJyLCBpbmZvKTogdm9pZCB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgcmV0dXJuIG5leHQoZXJyKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXMuc2V0KEhFQURFUl9UWVBFLkNPTlRFTlRfVFlQRSwgSEVBREVSUy5URVhUX1BMQUlOKTtcbiAgICAgICAgICBuZXh0KHBhcnNlUmVhZG1lKGluZm8ubmFtZSwgaW5mby5yZWFkbWUpKTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cbiAgKTtcblxuICBwa2dSb3V0ZXIuZ2V0KFxuICAgIFt3cmFwUGF0aChXZWJVcmxzLnNpZGViYXJfc2NvcHBlZF9wYWNrYWdlKSwgd3JhcFBhdGgoV2ViVXJscy5zaWRlYmFyX3BhY2thZ2UpXSxcbiAgICBjYW4oJ2FjY2VzcycpLFxuICAgIGZ1bmN0aW9uIChyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQge1xuICAgICAgY29uc3QgcmF3U2NvcGUgPSByZXEucGFyYW1zLnNjb3BlOyAvLyBNYXkgaW5jbHVkZSAnQCdcbiAgICAgIGNvbnN0IHNjb3BlID0gcmF3U2NvcGUgPyByYXdTY29wZS5zbGljZSgxKSA6IG51bGw7IC8vIFJlbW92ZSAnQCcgaWYgcHJlc2VudFxuICAgICAgY29uc3QgcGFja2FnZU5hbWU6IHN0cmluZyA9IHNjb3BlID8gYWRkU2NvcGUoc2NvcGUsIHJlcS5wYXJhbXMucGFja2FnZSkgOiByZXEucGFyYW1zLnBhY2thZ2U7XG5cbiAgICAgIHN0b3JhZ2UuZ2V0UGFja2FnZSh7XG4gICAgICAgIG5hbWU6IHBhY2thZ2VOYW1lLFxuICAgICAgICB1cGxpbmtzTG9vazogdHJ1ZSxcbiAgICAgICAga2VlcFVwTGlua0RhdGE6IHRydWUsXG4gICAgICAgIHJlcSxcbiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uIChlcnI6IEVycm9yLCBpbmZvOiAkU2lkZWJhclBhY2thZ2UpOiB2b2lkIHtcbiAgICAgICAgICBpZiAoXy5pc05pbChlcnIpKSB7XG4gICAgICAgICAgICBjb25zdCB7IHYgfSA9IHJlcS5xdWVyeTtcbiAgICAgICAgICAgIGxldCBzaWRlQmFySW5mbzogYW55ID0gXy5jbG9uZShpbmZvKTtcbiAgICAgICAgICAgIHNpZGVCYXJJbmZvLnZlcnNpb25zID0gY29udmVydERpc3RSZW1vdGVUb0xvY2FsVGFyYmFsbFVybHMoXG4gICAgICAgICAgICAgIGluZm8sXG4gICAgICAgICAgICAgIHsgcHJvdG9jb2w6IHJlcS5wcm90b2NvbCwgaGVhZGVyczogcmVxLmhlYWRlcnMgYXMgYW55LCBob3N0OiByZXEuaG9zdG5hbWUgfSxcbiAgICAgICAgICAgICAgY29uZmlnLnVybF9wcmVmaXhcbiAgICAgICAgICAgICkudmVyc2lvbnM7XG4gICAgICAgICAgICBpZiAoaXNWZXJzaW9uVmFsaWQoaW5mbywgdikpIHtcbiAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICBzaWRlQmFySW5mby5sYXRlc3QgPSBzaWRlQmFySW5mby52ZXJzaW9uc1t2XTtcbiAgICAgICAgICAgICAgc2lkZUJhckluZm8ubGF0ZXN0LmF1dGhvciA9IGZvcm1hdEF1dGhvcihzaWRlQmFySW5mby5sYXRlc3QuYXV0aG9yKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHNpZGVCYXJJbmZvLmxhdGVzdCA9IHNpZGVCYXJJbmZvLnZlcnNpb25zW2luZm9bRElTVF9UQUdTXS5sYXRlc3RdO1xuICAgICAgICAgICAgICBpZiAoc2lkZUJhckluZm8/LmxhdGVzdCkge1xuICAgICAgICAgICAgICAgIHNpZGVCYXJJbmZvLmxhdGVzdC5hdXRob3IgPSBmb3JtYXRBdXRob3Ioc2lkZUJhckluZm8ubGF0ZXN0LmF1dGhvcik7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5OT1RfRk9VTkQpO1xuICAgICAgICAgICAgICAgIHJlcy5lbmQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNpZGVCYXJJbmZvID0gZGVsZXRlUHJvcGVydGllcyhbJ3JlYWRtZScsICdfYXR0YWNobWVudHMnLCAnX3JldicsICduYW1lJ10sIHNpZGVCYXJJbmZvKTtcbiAgICAgICAgICAgIGlmIChjb25maWcud2ViKSB7XG4gICAgICAgICAgICAgIHNpZGVCYXJJbmZvID0gYWRkR3JhdmF0YXJTdXBwb3J0KHNpZGVCYXJJbmZvLCBjb25maWcud2ViLmdyYXZhdGFyKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHNpZGVCYXJJbmZvID0gYWRkR3JhdmF0YXJTdXBwb3J0KHNpZGVCYXJJbmZvKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5leHQoc2lkZUJhckluZm8pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLk5PVF9GT1VORCk7XG4gICAgICAgICAgICByZXMuZW5kKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuICApO1xuXG4gIHJldHVybiBwa2dSb3V0ZXI7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGFkZFBhY2thZ2VXZWJBcGk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLFFBQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLE9BQUEsR0FBQUMsc0JBQUEsQ0FBQUYsT0FBQTtBQUVBLElBQUFHLE9BQUEsR0FBQUgsT0FBQTtBQUNBLElBQUFJLFdBQUEsR0FBQUosT0FBQTtBQUNBLElBQUFLLFFBQUEsR0FBQUwsT0FBQTtBQUtBLElBQUFNLE1BQUEsR0FBQU4sT0FBQTtBQUdBLElBQUFP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