{"version":3,"file":"utils.js","names":["_lockfile","_interopRequireDefault","require","fsP","_interopRequireWildcard","_nodePath","_nodeUtil","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","readFile","exports","statPromise","stat","lfLock","promisify","locker","lock","lfUnlock","unlock","statDir","name","dirPath","path","dirname","stats","isDirectory","Error","statFile","isFile","lockFileWithOptions","options","lockOpts","wait","pollPeriod","stale","retries","retryWait","unlockFileNext","lockFileName"],"sources":["../src/utils.ts"],"sourcesContent":["import locker from 'lockfile';\nimport * as fsP from 'node:fs/promises';\nimport path from 'node:path';\nimport { promisify } from 'node:util';\n\nexport const readFile = fsP.readFile;\nconst statPromise = fsP.stat;\n// https://github.com/npm/lockfile/issues/33\nconst lfLock = promisify(locker.lock);\nconst lfUnlock = promisify(locker.unlock);\n\n/**\n * Test to see if the directory exists\n * @param name\n * @returns\n */\nexport async function statDir(name: string): Promise<void> {\n  const dirPath = path.dirname(name);\n  const stats = await statPromise(dirPath);\n  if (!stats.isDirectory()) {\n    throw new Error(`${path.dirname(name)} is not a directory`);\n  }\n  return;\n}\n\n/**\n *  test to see if the directory exists\n * @param name\n * @returns\n */\nexport async function statFile(name: string): Promise<void> {\n  const stats = await statPromise(name);\n  if (!stats.isFile()) {\n    throw new Error(`${path.dirname(name)} is not a file`);\n  }\n  return;\n}\n\n/**\n * Lock a file\n * @param name name of the file to lock\n */\nexport async function lockFileWithOptions(name: string, options?: any): Promise<void> {\n  const lockOpts = {\n    // time (ms) to wait when checking for stale locks\n    wait: 1000,\n    // how often (ms) to re-check stale locks\n    pollPeriod: 100,\n    // locks are considered stale after 5 minutes\n    stale: 5 * 60 * 1000,\n    // number of times to attempt to create a lock\n    retries: 100,\n    // time (ms) between tries\n    retryWait: 100,\n    ...options,\n  };\n  await lfLock(`${name}.lock`, lockOpts);\n}\n\n// unlocks file by removing existing lock file\nexport async function unlockFileNext(name: string): Promise<void> {\n  const lockFileName = `${name}.lock`;\n  return lfUnlock(lockFileName);\n}\n"],"mappings":"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","ignoreList":[]}