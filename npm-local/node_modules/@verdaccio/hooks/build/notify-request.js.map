{"version":3,"file":"notify-request.js","names":["_debug","_interopRequireDefault","require","_gotCjs","_core","_logger","e","__esModule","default","debug","buildDebug","notifyRequest","url","options","response","got","post","body","JSON","stringify","method","headers","status","json","HTTP_STATUS","BAD_REQUEST","Error","logger","info","content","err","error","errorMessage","message"],"sources":["../src/notify-request.ts"],"sourcesContent":["import buildDebug from 'debug';\nimport got from 'got-cjs';\n\nimport { HTTP_STATUS } from '@verdaccio/core';\nimport { logger } from '@verdaccio/logger';\n\nconst debug = buildDebug('verdaccio:hooks:request');\n\nexport type FetchOptions = {\n  body: string;\n  headers?: {};\n  method?: string;\n};\n\nexport async function notifyRequest(url: string, options: FetchOptions): Promise<boolean> {\n  let response;\n  try {\n    debug('uri %o', url);\n    response = got.post(url, {\n      body: JSON.stringify(options.body),\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n    });\n    debug('response.status  %o', response.status);\n    const body = await response.json();\n    if (response.status >= HTTP_STATUS.BAD_REQUEST) {\n      throw new Error(body);\n    }\n\n    logger.info(\n      { content: options.body },\n      'The notification @{content} has been successfully dispatched'\n    );\n    return true;\n  } catch (err: any) {\n    debug('request error %o', err);\n    logger.error(\n      { errorMessage: err?.message },\n      'notify service has thrown an error: @{errorMessage}'\n    );\n    return false;\n  }\n}\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,OAAA,GAAAF,sBAAA,CAAAC,OAAA;AAEA,IAAAE,KAAA,GAAAF,OAAA;AACA,IAAAG,OAAA,GAAAH,OAAA;AAA2C,SAAAD,uBAAAK,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAE3C,MAAMG,KAAK,GAAG,IAAAC,cAAU,EAAC,yBAAyB,CAAC;AAQ5C,eAAeC,aAAaA,CAACC,GAAW,EAAEC,OAAqB,EAAoB;EACxF,IAAIC,QAAQ;EACZ,IAAI;IACFL,KAAK,CAAC,QAAQ,EAAEG,GAAG,CAAC;IACpBE,QAAQ,GAAGC,eAAG,CAACC,IAAI,CAACJ,GAAG,EAAE;MACvBK,IAAI,EAAEC,IAAI,CAACC,SAAS,CAACN,OAAO,CAACI,IAAI,CAAC;MAClCG,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QAAE,cAAc,EAAE;MAAmB;IAChD,CAAC,CAAC;IACFZ,KAAK,CAAC,qBAAqB,EAAEK,QAAQ,CAACQ,MAAM,CAAC;IAC7C,MAAML,IAAI,GAAG,MAAMH,QAAQ,CAACS,IAAI,CAAC,CAAC;IAClC,IAAIT,QAAQ,CAACQ,MAAM,IAAIE,iBAAW,CAACC,WAAW,EAAE;MAC9C,MAAM,IAAIC,KAAK,CAACT,IAAI,CAAC;IACvB;IAEAU,cAAM,CAACC,IAAI,CACT;MAAEC,OAAO,EAAEhB,OAAO,CAACI;IAAK,CAAC,EACzB,8DACF,CAAC;IACD,OAAO,IAAI;EACb,CAAC,CAAC,OAAOa,GAAQ,EAAE;IACjBrB,KAAK,CAAC,kBAAkB,EAAEqB,GAAG,CAAC;IAC9BH,cAAM,CAACI,KAAK,CACV;MAAEC,YAAY,EAAEF,GAAG,EAAEG;IAAQ,CAAC,EAC9B,qDACF,CAAC;IACD,OAAO,KAAK;EACd;AACF","ignoreList":[]}